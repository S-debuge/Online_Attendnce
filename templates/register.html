<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register</title>
    <style>
        /* BASIC PAGE STYLING */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: linear-gradient(135deg, #001F54, #FCA311);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            animation: fadeBg 5s ease-in-out infinite alternate;
        }
        @keyframes fadeBg {
            0% { background: linear-gradient(135deg, #001F54, #FCA311); }
            100% { background: linear-gradient(135deg, #14213d, #ffb703); }
        }
        .register-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            padding: 30px;
            width: 500px;
            max-width: 95%;
            animation: slideUp 0.9s ease-out;
        }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(40px) scale(0.9); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        h1 { text-align: center; margin-bottom: 15px; color: #001F54; font-size: 1.8rem; }
        .tabs { display: flex; justify-content: space-between; margin-bottom: 20px; border-bottom: 2px solid #ddd; }
        .tab { flex: 1; padding: 10px; cursor: pointer; font-weight: bold; color: #888; text-align: center; position: relative; transition: color 0.3s ease-in-out, transform 0.3s ease-in-out; }
        .tab:hover { color: #001F54; transform: scale(1.05); }
        .tab.active { color: #001F54; }
        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 100%;
            height: 3px;
            background-color: #FCA311;
            border-radius: 10px;
            animation: underline 0.3s ease forwards;
        }
        @keyframes underline { from { width: 0; } to { width: 100%; } }
        form { display: none; flex-direction: column; gap: 12px; animation: fadeIn 0.6s ease-in-out; }
        form.active { display: flex; }
        input, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px; transition: all 0.2s ease; font-size: 14px; }
        input:focus, select:focus { outline: none; border-color: #FCA311; box-shadow: 0 0 6px rgba(252,163,17,0.4); }
        small.error-text { font-size: 13px; margin-top: -5px; margin-bottom: 5px; display: block; min-height: 16px; }
        button { background: #001F54; color: white; border: none; padding: 12px; width: 100%; border-radius: 8px; font-weight: bold; margin-top: 10px; cursor: pointer; transition: transform 0.2s ease, background 0.3s ease; }
        button:hover { transform: translateY(-3px); background: #14213D; }
        video, canvas, img { max-width: 100%; margin-top: 10px; border-radius: 8px; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div class="register-container">
        <h1>‚ú® Register Now</h1>

        <div class="tabs">
            <div class="tab active" data-form="student-form">üë®‚Äçüéì Student</div>
            <div class="tab" data-form="teacher-form">üë®‚Äçüè´ Teacher</div>
            <div class="tab" data-form="parent-form">üë®‚Äçüë©‚Äçüë¶ Parent</div>
        </div>

        {% for message in messages %}
            <p style="color:red; text-align:center;">{{ message }}</p>
        {% endfor %}

        <!-- STUDENT FORM -->
        <form id="student-form" class="active" method="POST">
            {% csrf_token %}
            <input type="hidden" name="form_type" value="student">
            <input type="text" name="name" placeholder="Full Name" required>
            <input type="email" id="student_email" name="email" placeholder="Email" required>
            <small id="student_email_error" class="error-text"></small>
            <input type="text" name="phone" placeholder="Phone" required>
            <input type="text" name="address" placeholder="Address" required>
            <input type="text" id="student_roll" name="roll_number" placeholder="Roll Number" required>
            <small id="student_roll_error" class="error-text"></small>

            <!-- ‚úÖ Gender & Age -->
            <select name="gender" required>
                <option value="">Select Gender</option>
                <option value="Male">Male</option>
                <option value="Female">Female</option>
                <option value="Other">Other</option>
            </select>
            <input type="number" name="age" placeholder="Age" min="1" required>

            <select name="course" required>
                <option value="">Select Course</option>
                <option value="BE">BE</option>
                <option value="BTech">B.Tech</option>
                <option value="Diploma">Diploma</option>
            </select>

            <select name="branch" required>
                <option value="">Select Branch</option>
                <option value="Mechanical">Mechanical</option>
                <option value="Computer">Computer</option>
                <option value="Civil">Civil</option>
                <option value="Electrical">Electrical</option>
                <option value="ENTC">ENTC</option>
            </select>

            <select name="year" required>
                <option value="">Select Year</option>
                <option value="First Year">First Year</option>
                <option value="Second Year">Second Year</option>
                <option value="Third Year">Third Year</option>
                <option value="Fourth Year">Fourth Year</option>
            </select>

            <input type="text" name="parent_fullname" placeholder="Parent Name" required>
            <select name="guardian_teacher" required>
                <option value="">Select Guardian Teacher</option>
                {% for teacher in teachers %}
                    <option value="{{ teacher.name }}">{{ teacher.name }}</option>
                {% endfor %}
            </select>

            <input type="password" name="password" placeholder="Password" required>
            <video id="video-student" autoplay></video>
            <canvas id="canvas-student" style="display:none;"></canvas>
            <img id="preview-student" style="display:none;">
            <input type="hidden" name="photo_data" id="photo-student">
            <button type="button" onclick="startCamera('student')">üì∑ Start Camera</button>
            <button type="button" onclick="capturePhoto('student')">üì∏ Capture Photo</button>
            <button type="submit">‚úÖ Register Student</button>
        </form>

        <!-- TEACHER FORM -->
        <form id="teacher-form" method="POST">
            {% csrf_token %}
            <input type="hidden" name="form_type" value="teacher">
            <input type="text" name="name" placeholder="Full Name" required>
            <input type="email" id="teacher_email" name="email" placeholder="Email" required>
            <small id="teacher_email_error" class="error-text"></small>
            <input type="text" name="phone" placeholder="Phone" required>
            <input type="text" name="address" placeholder="Address" required>
            <input type="text" name="department" placeholder="Department" required>
            <input type="text" name="subject" placeholder="Subject" required>
            <input type="text" id="teacher_emp_id" name="employee_id" placeholder="Employee ID" required>
            <small id="teacher_emp_error" class="error-text"></small>

            <!-- ‚úÖ Gender -->
            <select name="gender" required>
                <option value="">Select Gender</option>
                <option value="Male">Male</option>
                <option value="Female">Female</option>
                <option value="Other">Other</option>
            </select>

            <input type="password" name="password" placeholder="Password" required>
            <video id="video-teacher" autoplay></video>
            <canvas id="canvas-teacher" style="display:none;"></canvas>
            <img id="preview-teacher" style="display:none;">
            <input type="hidden" name="photo_data" id="photo-teacher">
            <button type="button" onclick="startCamera('teacher')">üì∑ Start Camera</button>
            <button type="button" onclick="capturePhoto('teacher')">üì∏ Capture Photo</button>
            <button type="submit">‚úÖ Register Teacher</button>
        </form>

        <!-- PARENT FORM -->
        <form id="parent-form" method="POST">
            {% csrf_token %}
            <input type="hidden" name="form_type" value="parent">
            <input type="text" name="name" placeholder="Full Name" required>
            <input type="email" id="parent_email" name="email" placeholder="Email" required>
            <small id="parent_email_error" class="error-text"></small>
            <input type="text" name="phone" placeholder="Phone" required>
            <input type="text" name="address" placeholder="Address" required>
            <input type="text" id="parent_aadhaar" name="aadhaar" placeholder="Aadhaar Number" required>
            <small id="parent_aadhaar_error" class="error-text"></small>

            <!-- ‚úÖ Gender -->
            <select name="gender" required>
                <option value="">Select Gender</option>
                <option value="Male">Male</option>
                <option value="Female">Female</option>
                <option value="Other">Other</option>
            </select>

            <!-- Relation -->
            <select name="relation" required>
                <option value="">Select Relation</option>
                <option value="Father">Father</option>
                <option value="Mother">Mother</option>
                <option value="Guardian">Guardian</option>
            </select>

            <select name="student_id" required>
                <option value="">Select Student</option>
                {% for student in students %}
                    <option value="{{ student.id }}">{{ student.name }}</option>
                {% endfor %}
            </select>
            <input type="password" name="password" placeholder="Password" required>
            <video id="video-parent" autoplay></video>
            <canvas id="canvas-parent" style="display:none;"></canvas>
            <img id="preview-parent" style="display:none;">
            <input type="hidden" name="photo_data" id="photo-parent">
            <button type="button" onclick="startCamera('parent')">üì∑ Start Camera</button>
            <button type="button" onclick="capturePhoto('parent')">üì∏ Capture Photo</button>
            <button type="submit">‚úÖ Register Parent</button>
        </form>
    </div>

    <script>
        const tabs = document.querySelectorAll('.tab');
        const forms = document.querySelectorAll('form');
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                tabs.forEach(t => t.classList.remove('active'));
                forms.forEach(f => f.classList.remove('active'));
                tab.classList.add('active');
                document.getElementById(tab.dataset.form).classList.add('active');
            });
        });

        async function startCamera(type) {
            const video = document.getElementById(`video-${type}`);
            let stream = await navigator.mediaDevices.getUserMedia({ video: true });
            video.srcObject = stream;
        }

        function capturePhoto(type) {
            const video = document.getElementById(`video-${type}`);
            const canvas = document.getElementById(`canvas-${type}`);
            const preview = document.getElementById(`preview-${type}`);
            const photoInput = document.getElementById(`photo-${type}`);
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            canvas.getContext('2d').drawImage(video, 0, 0);
            let imgData = canvas.toDataURL('image/png');
            preview.src = imgData;
            preview.style.display = 'block';
            photoInput.value = imgData;
        }

        async function checkUnique(field, value, errorId) {
            if (!value) return;
            let res = await fetch(`/check-unique/?field=${field}&value=${value}`);
            let data = await res.json();
            const errorElement = document.getElementById(errorId);
            if (data.exists) {
                errorElement.innerText = "‚ùå Already taken";
                errorElement.style.color = "red";
            } else {
                errorElement.innerText = "‚úî Available";
                errorElement.style.color = "green";
            }
        }

        document.getElementById("student_email").addEventListener("blur", () => {
            checkUnique("student_email", document.getElementById("student_email").value, "student_email_error");
        });
        document.getElementById("student_roll").addEventListener("blur", () => {
            checkUnique("student_roll_number", document.getElementById("student_roll").value, "student_roll_error");
        });
        document.getElementById("teacher_email").addEventListener("blur", () => {
            checkUnique("teacher_email", document.getElementById("teacher_email").value, "teacher_email_error");
        });
        document.getElementById("teacher_emp_id").addEventListener("blur", () => {
            checkUnique("teacher_employee_id", document.getElementById("teacher_emp_id").value, "teacher_emp_error");
        });
        document.getElementById("parent_email").addEventListener("blur", () => {
            checkUnique("parent_email", document.getElementById("parent_email").value, "parent_email_error");
        });
        document.getElementById("parent_aadhaar").addEventListener("blur", () => {
            checkUnique("parent_aadhaar", document.getElementById("parent_aadhaar").value, "parent_aadhaar_error");
        });

        forms.forEach(form => {
            form.addEventListener("submit", function(event){
                const photoInput = form.querySelector("input[name='photo_data']");
                if (!photoInput.value) {
                    alert("Please capture a photo before submitting!");
                    event.preventDefault();
                }
            });
        });
    </script>
</body>
</html>
